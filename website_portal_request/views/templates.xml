<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="website_request_portal_assets"
              inherit_id="website.assets_frontend"
              name="Request Website Assets">
        <xpath expr="." position="inside">
            <link rel='stylesheet' href='/website_portal_request/static/src/css/request.css'/>
            <script type="text/javascript" src="/website_portal_request/static/src/js/request_discussion.js"/>
            <script type="text/javascript" src="/website_portal_request/static/src/js/request_new.js"/>
        </xpath>
    </template>

    <template id="portal_my_home_menu_request"
              name="Portal request : Request"
              inherit_id="website_portal_v10.portal_layout"
              priority="20">
        <xpath expr="//ul[contains(@class,'o_portal_submenu')]"
               position="inside">
            <li>
                <a href="/my/requests">Requests</a>
            </li>
        </xpath>
    </template>

    <template id="portal_my_requests" name="My requests">
        <t t-call="website_portal_v10.portal_layout">
            <h3 class="page-header">Your requests
                <a class="btn btn-success pull-right"
                   href="/my/requests/new">New</a>
            </h3>
            
            <t t-if="not reqs">
                <p>There are currently no requests in the your account.</p>
            </t>
            <t t-if="reqs">
                <table class="table table-hover table-condensed">
                    <thead>
                        <tr class="active">
                            <th>Request #</th>
                            <th>Category</th>
                            <th>Type Name</th>
                            <th>Stage</th>
                        </tr>
                    </thead>
                    <t t-foreach="reqs" t-as="req">
                        <tr>
                            <td>
                                <a t-attf-href="/my/requests/{{req.id}}"><t t-esc="req.name"/></a>
                            </td>
                            <td><span t-field="req.type_id.category_id.display_name"/></td>
                            <td><span t-field="req.type_id.name"/></td>
                            <td><span t-field="req.stage_id.name"/></td>
                        </tr>
                    </t>
                </table>
            </t>
        </t>
    </template>

    <template id="portal_my_request" name="My request">
        <t t-call="website_portal_v10.portal_layout">
            <div class="row">
                <div class="col-md-10">
                    <h1><span t-field="req.name"/></h1>
                </div>
                <div class="col-md-2">
                    <h2><span class="label label-primary" t-field="req.stage_id.name"/></h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <h3><span t-field="req.type_id.category_id.display_name"/> / 
                        <span t-field="req.type_id.name"/></h3>
                </div>
            </div>
            <hr/>
            <t t-if="req.stage_help_html">
                <div class="row">
                    <div class="col-md-12" t-if="req.stage_help_html">
                        <t t-raw="req.stage_help_html"/>
                    </div>
                </div>
                <hr/>
            </t>
            <div class="row">
                <div class="col-md-12">
                    <div id="request_body"
                         t-field="req.request_text"/>
                </div>
            </div>
            <hr/>
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mb8">
                    <span t-field="req.created_by_id.image_small"
                            class="o_not_editable"
                            t-field-options='{"widget": "image", "class": "pull-left"}'/>
                    <div class="pull-left">
                        <label>Created</label>
                        <div t-field="req.date_created"/>
                        <div t-field="req.created_by_id"/>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mb8">
                    <t t-if="req.date_assigned">
                        <!--<i class="fa fa-arrow-right pull-left mt24 text-primary"/>-->
                        <span t-field="req.user_id.image_small"
                              class="o_not_editable"
                              t-field-options='{"widget": "image", "class": "pull-left"}'/>
                        <div class="pull-left">
                            <label>Assigned</label>
                            <div t-field="req.date_assigned"/>
                            <div t-field="req.user_id"/>
                        </div>
                    </t>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12 mb8"
                        attrs="{'invisible': [('date_closed', '=', False)]}">
                    <t t-if="date_closed">
                        <span t-field="req.closed_by_id.image_small"
                              class="o_not_editable"
                              t-field-options='{"widget": "image", "class": "pull-left"}'/>
                        <div class="pull-left">
                            <label>Closed</label>
                            <div t-field="req.date_closed"/>
                            <div t-field="req.closed_by_id"/>
                        </div>
                    </t>
                </div>
            </div>
            <hr/>
            <t t-call="website_portal_request.rich_message_thread">
                <t t-set="object" t-value="req"/>
                <t t-set="chatter_mode" t-value="'json'"/>
            </t>
        </t>
    </template>

    <template id="portal_my_home_request" name="Portal My Home Request"
              inherit_id="website_portal_v10.portal_my_home" priority="25">
        <xpath expr="//div[contains(@class,'o_my_home_content')]" position="inside">
            <h3 class="page-header">
                <a href="/my/requests">Your Requests
                    <small class="ml8">
                        <t t-if="req_count">
                            <span class='badge'><t t-esc="req_count"/></span>
                        </t>
                        <t t-if="not req_count">
                            There are currently no requests for your account.<br/>
                            <a href="/my/requests/new">Create one</a>
                        </t>
                    </small>
                </a>
                <a class="btn btn-success pull-right"
                   href="/my/requests/new">New</a>
            </h3>
        </xpath>
    </template>

    <template id="portal_my_requests_new" name="My request">
        <t t-call="website_portal_v10.portal_layout">
            <form id="form_request_create"
                    class="container-fluid form-horizontal"
                    action="/"
                    method="post" role="form">
                <h1>Create new request</h1>
                <hr/>
                <div class="row">
                    <div class="col-md-4">
                        <h2>Category</h2>
                    </div>
                    <div class="col-md-8">
                        <h2>
                            <select id="request_category"
                                    class="form-control"
                                    required="">
                            </select>
                        </h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <h3>Type</h3>
                    </div>
                    <div class="col-md-8">
                        <h3>
                            <select id="request_type"
                                    class="form-control"
                                    required="">
                            </select>
                        </h3>
                        <div id="request_help" class="col-md-8 col-md-offset-4"/>
                    </div>
                </div>
                <hr/>
                <div class="row">
                    <div class="col-md-12">
                        <textarea id="request_text"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 col-xs-6">
                        <button class="btn btn-primary btn-lg a-submit col-md-6">
                            Save
                        </button>
                    </div>
                    <div class="col-md-6 col-xs-6">
                        <button class="btn btn-danger btn-lg pull-right">
                            Cancel
                        </button>
                    </div>
                </div>
            </form>
        </t>
    </template>
</odoo>
